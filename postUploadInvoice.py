import xml.etree.ElementTree as ET
import requests
import q_updateTotalesFacturaTeched
#Define Variables Globales
userNameDemo='GAMA070223'
passwordDemo='502d77c7c1d5fa0f4495d104b29ad80cda2510238fb66ba7f107303317d49bc5'
#base64InvoiceExample= 'PEZBQ1RVUkEgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeG1sbnM6eHNkPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSI+DQoJPEVOQz4NCgkJPEVOQ18xPklOVk9JQzwvRU5DXzE+DQoJCTxFTkNfMj45MDExNDMzMTE8L0VOQ18yPg0KCQk8RU5DXzM+MjIyMjIyMjIyMjIyPC9FTkNfMz4NCgkJPEVOQ180PlVCTCAyLjE8L0VOQ180Pg0KCQk8RU5DXzU+RElBTiAyLjE8L0VOQ181Pg0KCQk8RU5DXzY+VENGQTI2MTA2PC9FTkNfNj4NCgkJPEVOQ183PjIwMjMtMDktMjU8L0VOQ183Pg0KCQk8RU5DXzg+MjI6MTU6MDAtMDU6MDA8L0VOQ184Pg0KCQk8RU5DXzk+MDE8L0VOQ185Pg0KCQk8RU5DXzEwPkNPUDwvRU5DXzEwPg0KCQk8RU5DXzE1PjQ8L0VOQ18xNT4NCgkJPEVOQ18yMD4yPC9FTkNfMjA+DQoJCTxFTkNfMjE+MTA8L0VOQ18yMT4NCgk8L0VOQz4NCgk8RU1JPg0KCQk8RU1JXzE+MTwvRU1JXzE+DQoJCTxFTUlfMj45MDExNDMzMTE8L0VNSV8yPg0KCQk8RU1JXzM+MzE8L0VNSV8zPg0KCQk8RU1JXzQ+MTA8L0VNSV80Pg0KCQk8RU1JXzY+RkFST1ogU0FTPC9FTUlfNj4NCgkJPEVNSV83PkZBUk9aIFNBUzwvRU1JXzc+DQoJCTxFTUlfMTA+Q2FsbGUgNTEgNjktNDc8L0VNSV8xMD4NCgkJPEVNSV8xMT4wNTwvRU1JXzExPg0KCQk8RU1JXzEzPk1FREVMTElOPC9FTUlfMTM+DQoJCTxFTUlfMTU+Q088L0VNSV8xNT4NCgkJPEVNSV8xOT5BbnRpb3F1aWE8L0VNSV8xOT4NCgkJPEVNSV8yMj44PC9FTUlfMjI+DQoJCTxFTUlfMjM+MDUwMDE8L0VNSV8yMz4NCgkJPEVNSV8yND5GQVJPWiBTQVM8L0VNSV8yND4NCgkJPFRBQz4NCgkJCTxUQUNfMT5PLTIzPC9UQUNfMT4NCgkJPC9UQUM+DQoJCTxERkU+DQoJCQk8REZFXzE+MDUwMDE8L0RGRV8xPg0KCQkJPERGRV8yPjA1PC9ERkVfMj4NCgkJCTxERkVfMz5DTzwvREZFXzM+DQoJCQk8REZFXzQ+MDUwMDIxPC9ERkVfND4NCgkJCTxERkVfNT5Db2xvbWJpYTwvREZFXzU+DQoJCQk8REZFXzY+QW50aW9xdWlhPC9ERkVfNj4NCgkJCTxERkVfNz5NRURFTExJTjwvREZFXzc+DQoJCQk8REZFXzg+Q0FMTEUgQ09MT01CSUE8L0RGRV84Pg0KCQk8L0RGRT4NCgkJPElDQz4NCgkJCTxJQ0NfMT4zNzc3Nzc8L0lDQ18xPg0KCQkJPElDQ185PlRDRkE8L0lDQ185Pg0KCQk8L0lDQz4NCgkJPENERT4NCgkJCTxDREVfMT4xPC9DREVfMT4NCgkJCTxDREVfMj5HSU9WQU5JIFJPWk8gR0VSRU5URTwvQ0RFXzI+DQoJCQk8Q0RFXzM+MzE2ODM2ODE3ODwvQ0RFXzM+DQoJCQk8Q0RFXzQ+aW5mb0BmYXJvei5jb20uY288L0NERV80Pg0KCQk8L0NERT4NCgkJPEdURT4NCgkJCTxHVEVfMT4wMTwvR1RFXzE+DQoJCQk8R1RFXzI+SVZBPC9HVEVfMj4NCgkJPC9HVEU+DQoJPC9FTUk+DQoJPEFEUT4NCgkJPEFEUV8xPjI8L0FEUV8xPg0KCQk8QURRXzI+MjIyMjIyMjIyMjIyPC9BRFFfMj4NCgkJPEFEUV8zPjEzPC9BRFFfMz4NCgkJPEFEUV80PjQ4PC9BRFFfND4NCgkJPEFEUV82PmZpbmFsIGNvbnN1bWlkb3I8L0FEUV82Pg0KCQk8QURRXzc+ZmluYWw8L0FEUV83Pg0KCQk8QURRXzg+Y29uc3VtaWRvcjwvQURRXzg+IAkJCQkJCQ0KCQk8QURRXzk+ZmluYWw8L0FEUV85PgkNCgkJPEFEUV8xMD5DUkEgMTAgIyAgMTAgLSAwMTwvQURRXzEwPg0KCQk8QURRXzExPjE4PC9BRFFfMTE+DQoJCTxBRFFfMTM+QU5USU9RVUlBPC9BRFFfMTM+DQoJCTxBRFFfMTQ+MTgwMDE8L0FEUV8xND4NCgkJPEFEUV8xNT5DTzwvQURRXzE1Pg0KCQk8QURRXzE5Pk1lZGVsbMOtbjwvQURRXzE5Pg0KCQk8QURRXzIxPkNvbG9tYmlhPC9BRFFfMjE+DQoNCgkJPEFEUV8yMz4xODAwMTwvQURRXzIzPg0KCQk8QURRXzI0PjE8L0FEUV8yND4NCgkJPFRDUj4NCgkJCTxUQ1JfMT5SLTk5LVBOPC9UQ1JfMT4NCgkJPC9UQ1I+DQoJCTxJTEE+DQoJCQk8SUxBXzE+ZmluYWw8L0lMQV8xPg0KCQkJPElMQV8yPjIyMjIyMjIyMjIyMjwvSUxBXzI+DQoJCQk8SUxBXzM+MTM8L0lMQV8zPg0KCQk8L0lMQT4NCgkJPERGQT4NCgkJCTxERkFfMT5DTzwvREZBXzE+DQoJCQk8REZBXzI+MDU8L0RGQV8yPg0KCQkJPERGQV8zPjA1MDAxPC9ERkFfMz4NCgkJCTxERkFfND4wNTAwMTwvREZBXzQ+DQoJCQk8REZBXzU+Q29sb21iaWE8L0RGQV81Pg0KCQkJPERGQV82PkFOVElPUVVJQTwvREZBXzY+DQoJCQk8REZBXzc+TWVkZWxsw61uPC9ERkFfNz4NCgkJCTxERkFfOD5DUkEgMTAgIyAgMTAgLSAwMTwvREZBXzg+DQoJCTwvREZBPg0KCQk8SUNSPg0KCQkJPElDUl8xPjc3Nzc3NzwvSUNSXzE+DQoJCTwvSUNSPg0KCQk8Q0RBPg0KCQkJPENEQV8xPjE8L0NEQV8xPg0KCQkJPENEQV8yPkhFQ1RPUiBDQU1QVVpBTk88L0NEQV8yPg0KCQkJPENEQV8zPjYwNDUzMzM0MzU8L0NEQV8zPg0KCQkJPENEQV80PmhjYW1wdXphbm9Ab3V0bG9vay5jb208L0NEQV80Pg0KCQk8L0NEQT4NCgkJPEdUQT4NCgkJCTxHVEFfMT4wMTwvR1RBXzE+DQoJCQk8R1RBXzI+SVZBPC9HVEFfMj4NCgkJPC9HVEE+DQoJPC9BRFE+DQoJPFRPVD4NCgkJPFRPVF8xPjE4MDAwMC4wMDwvVE9UXzE+IA0KCQk8VE9UXzI+Q09QPC9UT1RfMj4JCQ0KCQk8VE9UXzM+MTgwMDAwLjAwPC9UT1RfMz4gDQoJCTxUT1RfND5DT1A8L1RPVF80Pg0KCQk8VE9UXzU+MjEzMTAwLjAwPC9UT1RfNT4gDQoJCTxUT1RfNj5DT1A8L1RPVF82PgkJCQ0KCQk8VE9UXzc+MjEzMTAwLjAwPC9UT1RfNz4JDQoJCTxUT1RfOD5DT1A8L1RPVF84PgkJCQ0KCQk8VE9UXzk+MC4wMDwvVE9UXzk+CQkNCgkJPFRPVF8xMD5DT1A8L1RPVF8xMD4JDQoJCTxUT1RfMTE+MC4wMDwvVE9UXzExPg0KCQk8VE9UXzEyPkNPUDwvVE9UXzEyPg0KCTwvVE9UPg0KCTxUSU0+DQoJCTxUSU1fMT5mYWxzZTwvVElNXzE+DQoJCTxUSU1fMj44MDAuMDA8L1RJTV8yPiAJDQoJCTxUSU1fMz5DT1A8L1RJTV8zPg0KCQkJPElNUD4NCgkJCQk8SU1QXzE+MDI8L0lNUF8xPgkJDQoJCQkJPElNUF8yPjEwMDAwLjAwPC9JTVBfMj4gCQ0KCQkJCTxJTVBfMz5DT1A8L0lNUF8zPg0KCQkJCTxJTVBfND44MDAuMDA8L0lNUF80PgkJDQoJCQkJPElNUF81PkNPUDwvSU1QXzU+DQoJCQkJPElNUF82PjguMDA8L0lNUF82Pg0KCQkJPC9JTVA+DQoJPC9USU0+DQoJPFRJTT4NCgkJPFRJTV8xPmZhbHNlPC9USU1fMT4NCgkJPFRJTV8yPjMyMzAwLjAwPC9USU1fMj4gCQ0KCQk8VElNXzM+Q09QPC9USU1fMz4NCgkJCTxJTVA+DQoJCQkJPElNUF8xPjAxPC9JTVBfMT4JCQ0KCQkJCTxJTVBfMj4xNzAwMDAuMDA8L0lNUF8yPiAJDQoJCQkJPElNUF8zPkNPUDwvSU1QXzM+DQoJCQkJPElNUF80PjMyMzAwLjAwPC9JTVBfND4JCQ0KCQkJCTxJTVBfNT5DT1A8L0lNUF81Pg0KCQkJCTxJTVBfNj4xOS4wMDwvSU1QXzY+DQoJCQk8L0lNUD4NCgk8L1RJTT4NCgk8RFJGPg0KCQk8RFJGXzE+MjAxOTExMTEwMTUyPC9EUkZfMT4NCgkJPERSRl8yPjIwMTktMTEtMTE8L0RSRl8yPg0KCQk8RFJGXzM+MjAzMC0xMi0zMTwvRFJGXzM+DQoJCTxEUkZfND5UQ0ZBPC9EUkZfND4NCgkJPERSRl81PjI2MTAxPC9EUkZfNT4NCgkJPERSRl82PjI2MjAwPC9EUkZfNj4NCgk8L0RSRj4NCgk8TUVQPg0KCQk8TUVQXzE+MTA8L01FUF8xPg0KCQk8TUVQXzI+MTwvTUVQXzI+DQoJCTxNRVBfMz4yMDIzLTA5LTI1PC9NRVBfMz4NCgk8L01FUD4NCgk8SVRFPg0KCQk8SVRFXzE+MTwvSVRFXzE+DQoJCTxJVEVfMz4xLjAwMDA8L0lURV8zPiAJDQoJCTxJVEVfND45NDwvSVRFXzQ+CQkNCgkJPElURV81PjEwMDAwLjAwPC9JVEVfNT4JDQoJCTxJVEVfNj5DT1A8L0lURV82Pg0KCQk8SVRFXzc+MTAwMDAuMDA8L0lURV83Pg0KCQk8SVRFXzg+Q09QPC9JVEVfOD4NCgkJPElURV8xMT5CVVRJRkFSUkE8L0lURV8xMT4NCgkJPElURV8xOT4xMDAwMC4wMDwvSVRFXzE5Pg0KCQk8SVRFXzIwPkNPUDwvSVRFXzIwPg0KCQk8SVRFXzIxPjEwODAwLjAwPC9JVEVfMjE+CQ0KCQk8SVRFXzIyPkNPUDwvSVRFXzIyPg0KCQk8SVRFXzIyPkNPUDwvSVRFXzIyPg0KCQk8SVRFXzIzPjEwMDAwLjAwPC9JVEVfMjM+CQ0KCQk8SVRFXzI0PkNPUDwvSVRFXzI0Pg0KCQk8SVRFXzI3PjE8L0lURV8yNz4JCQkNCgkJPElURV8yOD45NDwvSVRFXzI4Pg0KCQk8SUFFPg0KCQkJPElBRV8xPlIuQlVUSTAxPC9JQUVfMT4NCgkJCTxJQUVfMj45OTk8L0lBRV8yPg0KCQk8L0lBRT4NCgkJPFRJST4NCgkJCTxUSUlfMT44MDAuMDA8L1RJSV8xPgkJDQoJCQk8VElJXzI+Q09QPC9USUlfMj4JCQkNCgkJCTxUSUlfMz5mYWxzZTwvVElJXzM+CQkJDQoJCQk8SUlNPg0KCQkJCTxJSU1fMT4wMjwvSUlNXzE+CQ0KCQkJCTxJSU1fMj44MDAuMDA8L0lJTV8yPgkNCgkJCQk8SUlNXzM+Q09QPC9JSU1fMz4JCQkJDQoJCQkJPElJTV80PjEwMDAwPC9JSU1fND4gDQoJCQkJPElJTV81PkNPUDwvSUlNXzU+CQkJCQkNCgkJCQk8SUlNXzY+OC4wMDwvSUlNXzY+ICANCgkJCTwvSUlNPg0KCQk8L1RJST4NCgk8L0lURT4NCgk8SVRFPg0KCQk8SVRFXzE+MjwvSVRFXzE+DQoJCTxJVEVfMz4xLjAwMDA8L0lURV8zPiAJDQoJCTxJVEVfND45NDwvSVRFXzQ+CQkNCgkJPElURV81PjUwMDAwLjAwPC9JVEVfNT4JDQoJCTxJVEVfNj5DT1A8L0lURV82Pg0KCQk8SVRFXzc+NTAwMDAuMDA8L0lURV83Pg0KCQk8SVRFXzg+Q09QPC9JVEVfOD4NCgkJPElURV8xMT5CRUFEUyBGVVJSWTwvSVRFXzExPg0KCQk8SVRFXzE5PjUwMDAwLjAwPC9JVEVfMTk+DQoJCTxJVEVfMjA+Q09QPC9JVEVfMjA+DQoJCTxJVEVfMjE+NTk1MDAuMDA8L0lURV8yMT4JDQoJCTxJVEVfMjI+Q09QPC9JVEVfMjI+DQoJCTxJVEVfMjM+NTAwMDAuMDA8L0lURV8yMz4JDQoJCTxJVEVfMjQ+Q09QPC9JVEVfMjQ+DQoJCTxJVEVfMjc+MTwvSVRFXzI3PgkJCQ0KCQk8SVRFXzI4Pjk0PC9JVEVfMjg+DQoJCTxJQUU+DQoJCQk8SUFFXzE+Uy4zMTIzPC9JQUVfMT4NCgkJCTxJQUVfMj45OTk8L0lBRV8yPg0KCQk8L0lBRT4NCgkJPFRJST4NCgkJCTxUSUlfMT45NTAwLjAwPC9USUlfMT4JCQ0KCQkJPFRJSV8yPkNPUDwvVElJXzI+CQkJDQoJCQk8VElJXzM+ZmFsc2U8L1RJSV8zPgkJCQ0KCQkJPElJTT4NCgkJCQk8SUlNXzE+MDE8L0lJTV8xPgkNCgkJCQk8SUlNXzI+OTUwMC4wMDwvSUlNXzI+CQ0KCQkJCTxJSU1fMz5DT1A8L0lJTV8zPgkJCQkNCgkJCQk8SUlNXzQ+NTAwMDA8L0lJTV80PiANCgkJCQk8SUlNXzU+Q09QPC9JSU1fNT4JCQkJCQ0KCQkJCTxJSU1fNj4xOS4wMDwvSUlNXzY+ICANCgkJCTwvSUlNPg0KCQk8L1RJST4NCgk8L0lURT4NCgk8SVRFPg0KCQk8SVRFXzE+MzwvSVRFXzE+DQoJCTxJVEVfMz4xLjAwMDA8L0lURV8zPiAJDQoJCTxJVEVfND45NDwvSVRFXzQ+CQkNCgkJPElURV81PjIwMDAwLjAwPC9JVEVfNT4JDQoJCTxJVEVfNj5DT1A8L0lURV82Pg0KCQk8SVRFXzc+MjAwMDAuMDA8L0lURV83Pg0KCQk8SVRFXzg+Q09QPC9JVEVfOD4NCgkJPElURV8xMT5QUkVTRVJWQVRJVk88L0lURV8xMT4NCgkJPElURV8xOT4yMDAwMC4wMDwvSVRFXzE5Pg0KCQk8SVRFXzIwPkNPUDwvSVRFXzIwPg0KCQk8SVRFXzIxPjIzODAwLjAwPC9JVEVfMjE+CQ0KCQk8SVRFXzIyPkNPUDwvSVRFXzIyPg0KCQk8SVRFXzIzPjIwMDAwLjAwPC9JVEVfMjM+CQ0KCQk8SVRFXzI0PkNPUDwvSVRFXzI0Pg0KCQk8SVRFXzI3PjE8L0lURV8yNz4JCQkNCgkJPElURV8yOD45NDwvSVRFXzI4Pg0KCQk8SUFFPg0KCQkJPElBRV8xPlNVTS4zMDA3PC9JQUVfMT4NCgkJCTxJQUVfMj45OTk8L0lBRV8yPg0KCQk8L0lBRT4NCgkJPFRJST4NCgkJCTxUSUlfMT4zODAwLjAwPC9USUlfMT4JCQ0KCQkJPFRJSV8yPkNPUDwvVElJXzI+CQkJDQoJCQk8VElJXzM+ZmFsc2U8L1RJSV8zPgkJCQ0KCQkJPElJTT4NCgkJCQk8SUlNXzE+MDE8L0lJTV8xPgkNCgkJCQk8SUlNXzI+MzgwMC4wMDwvSUlNXzI+CQ0KCQkJCTxJSU1fMz5DT1A8L0lJTV8zPgkJCQkNCgkJCQk8SUlNXzQ+MjAwMDA8L0lJTV80PiANCgkJCQk8SUlNXzU+Q09QPC9JSU1fNT4JCQkJCQ0KCQkJCTxJSU1fNj4xOS4wMDwvSUlNXzY+ICANCgkJCTwvSUlNPg0KCQk8L1RJST4NCgk8L0lURT4NCgk8SVRFPg0KCQk8SVRFXzE+NDwvSVRFXzE+DQoJCTxJVEVfMz4xLjAwMDA8L0lURV8zPiAJDQoJCTxJVEVfND45NDwvSVRFXzQ+CQkNCgkJPElURV81PjEwMDAwMC4wMDwvSVRFXzU+CQ0KCQk8SVRFXzY+Q09QPC9JVEVfNj4NCgkJPElURV83PjEwMDAwMC4wMDwvSVRFXzc+DQoJCTxJVEVfOD5DT1A8L0lURV84Pg0KCQk8SVRFXzExPkxPVU5HRSBCQVNJQzwvSVRFXzExPg0KCQk8SVRFXzE5PjEwMDAwMC4wMDwvSVRFXzE5Pg0KCQk8SVRFXzIwPkNPUDwvSVRFXzIwPg0KCQk8SVRFXzIxPjExOTAwMC4wMDwvSVRFXzIxPgkNCgkJPElURV8yMj5DT1A8L0lURV8yMj4NCgkJPElURV8yMz4xMDAwMDAuMDA8L0lURV8yMz4JDQoJCTxJVEVfMjQ+Q09QPC9JVEVfMjQ+DQoJCTxJVEVfMjc+MTwvSVRFXzI3PgkJCQ0KCQk8SVRFXzI4Pjk0PC9JVEVfMjg+DQoJCTxJQUU+DQoJCQk8SUFFXzE+Uy4zMTIxPC9JQUVfMT4NCgkJCTxJQUVfMj45OTk8L0lBRV8yPg0KCQk8L0lBRT4NCgkJPFRJST4NCgkJCTxUSUlfMT4wLjAwPC9USUlfMT4JCQ0KCQkJPFRJSV8yPkNPUDwvVElJXzI+CQkJDQoJCQk8VElJXzM+ZmFsc2U8L1RJSV8zPgkJCQ0KCQkJPElJTT4NCgkJCQk8SUlNXzE+MDE8L0lJTV8xPgkNCgkJCQk8SUlNXzI+MTkwMDAuMDA8L0lJTV8yPgkNCgkJCQk8SUlNXzM+Q09QPC9JSU1fMz4JCQkJDQoJCQkJPElJTV80PjEwMDAwMDwvSUlNXzQ+IA0KCQkJCTxJSU1fNT5DT1A8L0lJTV81PgkJCQkJDQoJCQkJPElJTV82PjE5LjAwPC9JSU1fNj4gIA0KCQkJPC9JSU0+DQoJCTwvVElJPg0KCTwvSVRFPg0KPC9GQUNUVVJBPg=='

# Define the URL of the SOAP web service
url = 'https://ws.facturatech.co/v2/demo/index.php?wsdl'

# Define the headers for the POST request
def postRequest(base64Invoice,facturaNumero):
    headers = {
        'SOAPAction': 'urn:https://ws.facturatech.co/v2/demo/#FtechAction.uploadInvoiceFile',
        'Content-Type': 'text/xml; charset=utf-8'
    }


    # Define the SOAP request payload as a string
    soap_request = f'''
    <Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
        <Body>
            <FtechAction.uploadInvoiceFile xmlns="urn:https://ws.facturatech.co/v2/demo/">
                <username>{userNameDemo}</username>
                <password>{passwordDemo}</password>
                <xmlBase64>{base64Invoice}</xmlBase64>
            </FtechAction.uploadInvoiceFile>
        </Body>
    </Envelope>
    '''

    # Send the POST request with headers and SOAP request payload
    response = requests.post(url, headers=headers, data=soap_request)
    #print(response)

    # Check the response status and content
    if response.status_code == 200:
        #print(response.text)
        #print(response.status_code)
        #print("Request succeeded. Response content:")
        root = ET.fromstring(response.text)
        result_element = root.find(".//transaccionID")
        result_value_transaction = result_element.text
        # print("Value of <transaccionID>:", result_value_transaction)
        if result_value_transaction:
            #Code for Update Field FacturaTeched in Table Totales DSNAccess2003
            q_updateTotalesFacturaTeched.updateTotalesFacturaTeched(facturaNumero)

    else:
        pass
        #print(f"Request failed with status code {response.status_code}.")

    #print('POST method UploadInvoice reached with sucessfull')
    return response.status_code, result_value_transaction